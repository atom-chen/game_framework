{
  "code": "import * as tslib_1 from \"tslib\";\r\nimport ConfigManager from \"../../games/ConfigManager\";\r\nimport { PlayerDataManager } from \"../../common/GameDataManager\";\r\nimport { GoodsType } from \"../../games/CommonDefine\";\r\nimport SoundManager from \"../../common/SoundManager\";\r\nimport { MiniManeger } from \"../../minigame/MiniManeger\";\r\nimport ViewChangeManager from \"../../games/ViewChangeManager\";\r\nimport { GameData } from \"../../common/GameData\";\r\nimport AnimationManager from \"../../manager/AnimationManager\";\r\nvar AddPsView = (function (_super) {\r\n    tslib_1.__extends(AddPsView, _super);\r\n    function AddPsView() {\r\n        var _this = _super.call(this) || this;\r\n        _this.className_key = \"AddPsView\";\r\n        _this.showEnterType = BasePopAnimationEnterType.SCALE_MODE_BACK;\r\n        _this.skin = \"game/uiView/AddSpView.json\";\r\n        return _this;\r\n    }\r\n    AddPsView.prototype.createChildren = function () {\r\n        _super.prototype.createChildren.call(this);\r\n    };\r\n    AddPsView.prototype.onAddStage = function () {\r\n        MiniManeger.instance.showInterstitialAd();\r\n        ViewChangeManager.getInstance().CommonView.removeBtEvent();\r\n        this.initView();\r\n        this.addEvent();\r\n        if (DeviceUtil.isQQMiniGame()) {\r\n        }\r\n        MiniManeger.instance.showBannerAd();\r\n    };\r\n    AddPsView.prototype.onRemoved = function () {\r\n        this.removeEvent();\r\n        if (DeviceUtil.isQQMiniGame()) {\r\n        }\r\n        Laya.timer.clearAll(this);\r\n    };\r\n    AddPsView.prototype.initView = function () {\r\n        var _this = this;\r\n        this.refreshPsLimitLessView();\r\n        this.nPsAdd = 5;\r\n        var stGameConfig = ConfigManager.getInstance().getGameConfigDataByID(3);\r\n        if (stGameConfig) {\r\n            this.nPsAdd = parseInt(stGameConfig.strValue);\r\n        }\r\n        BitmapLabelUtils.setLabel(this.spNum, this.nPsAdd.toString(), \"resource/assets/img/common/level_number1/level_number1_\", 0, \".png\", \"left\");\r\n        this.btn_close.visible = false;\r\n        if (DeviceUtil.isQQMiniGame() && GameData.getInstance().gameQQInfo.psViewCloseOpen) {\r\n            AnimationManager.instance.zoomTween(this.imageBtGet, this);\r\n            this.btLable.visible = true;\r\n            Laya.timer.once(2000, this, function () {\r\n                _this.btn_close.visible = true;\r\n            });\r\n        }\r\n        else {\r\n            this.btLable.visible = false;\r\n            Laya.timer.once(2000, this, function () {\r\n                _this.btLable.visible = true;\r\n            });\r\n        }\r\n    };\r\n    AddPsView.prototype.addEvent = function () {\r\n        this.imageBtGet.on(Laya.Event.CLICK, this, this.addPsWatchVideo);\r\n        this.btLable.on(Laya.Event.CLICK, this, this.onClick);\r\n        this.btn_close.on(Laya.Event.CLICK, this, this.onClose);\r\n    };\r\n    AddPsView.prototype.onClick = function () {\r\n        if (DeviceUtil.isQQMiniGame() && GameData.getInstance().gameQQInfo.psViewCloseOpen) {\r\n            MiniManeger.instance.playViderAd({});\r\n        }\r\n        else {\r\n            this.onClose();\r\n        }\r\n    };\r\n    AddPsView.prototype.removeEvent = function () {\r\n        this.imageBtGet.on(Laya.Event.CLICK, this, this.addPsWatchVideo);\r\n        this.btLable.off(Laya.Event.CLICK, this, this.onClick);\r\n        this.btn_close.off(Laya.Event.CLICK, this, this.onClose);\r\n    };\r\n    AddPsView.prototype.addPsWatchVideo = function () {\r\n        var _this = this;\r\n        SoundManager.getInstance().playEffect(\"button\", 1);\r\n        this.imageBtGet.off(Laya.Event.CLICK, this, this.addPsWatchVideo);\r\n        MiniManeger.instance.playViderAd({\r\n            successFun: function () {\r\n                _this.imageBtGet.on(Laya.Event.CLICK, _this, _this.addPsWatchVideo);\r\n                ViewChangeManager.getInstance().CommonView.addBtEvent();\r\n                _this.addPsFun();\r\n            },\r\n            failFun: function () {\r\n                _this.imageBtGet.on(Laya.Event.CLICK, _this, _this.addPsWatchVideo);\r\n            },\r\n            errorFun: function () {\r\n                _this.imageBtGet.on(Laya.Event.CLICK, _this, _this.addPsWatchVideo);\r\n            }\r\n        });\r\n    };\r\n    AddPsView.prototype.addPsFun = function () {\r\n        if (AddPsView.bCloseBinner)\r\n            MiniManeger.instance.hideBanner();\r\n        PlayerDataManager.getInstance().AddGoods(GoodsType.enum_GoodsType_Sp, this.nPsAdd);\r\n        PlayerDataManager.getInstance().addWatchVideoAddSpTime();\r\n        this.removeSelf();\r\n    };\r\n    AddPsView.prototype.onClose = function () {\r\n        var _this = this;\r\n        if (AddPsView.bCloseBinner)\r\n            MiniManeger.instance.hideBanner();\r\n        SoundManager.getInstance().playEffect(\"button\", 1);\r\n        ViewChangeManager.getInstance().CommonView.addBtEvent();\r\n        if (DeviceUtil.isTTMiniGame()) {\r\n            if (BaseConst.infos.gameInfo.ttPsClose) {\r\n                MiniManeger.instance.playViderAd({\r\n                    successFun: function () {\r\n                        _this.removeSelf();\r\n                    }\r\n                });\r\n            }\r\n            else {\r\n                this.removeSelf();\r\n            }\r\n        }\r\n        else {\r\n            this.removeSelf();\r\n        }\r\n    };\r\n    AddPsView.prototype.refreshPsLimitLessView = function () {\r\n        var nLen = this.box_up.numChildren > PlayerDataManager.getInstance().pNewFuncPsLimitless.nCurTime ? PlayerDataManager.getInstance().pNewFuncPsLimitless.nCurTime : this.box_up.numChildren;\r\n        for (var i = 0; i < nLen; ++i) {\r\n            var pData = this.box_up.getChildAt(i);\r\n            if (pData) {\r\n                pData.visible = true;\r\n            }\r\n        }\r\n        nLen = this.box_down.numChildren > PlayerDataManager.getInstance().pNewFuncPsLimitless.nCurTime ? PlayerDataManager.getInstance().pNewFuncPsLimitless.nCurTime : this.box_down.numChildren;\r\n        for (var i = 0; i < nLen; ++i) {\r\n            var pData = this.box_down.getChildAt(i);\r\n            if (pData) {\r\n                pData.visible = true;\r\n            }\r\n        }\r\n        var nLastCount = PlayerDataManager.getInstance().getPsLimitlessStateLastTime();\r\n        if (nLastCount <= 0) {\r\n            this.box_lable.visible = false;\r\n        }\r\n        else {\r\n            this.lable_number.text = nLastCount.toString();\r\n        }\r\n    };\r\n    AddPsView.bCloseBinner = true;\r\n    return AddPsView;\r\n}(BaseSceneUISkinPopView));\r\nexport default AddPsView;\r\n",
  "references": [
    "F:/gitpro/ecy_game_framework/game_framework_ecy/game_framework_ecy/src/script/games/ConfigManager.ts",
    "F:/gitpro/ecy_game_framework/game_framework_ecy/game_framework_ecy/src/script/common/GameDataManager.ts",
    "F:/gitpro/ecy_game_framework/game_framework_ecy/game_framework_ecy/src/script/games/CommonDefine.ts",
    "F:/gitpro/ecy_game_framework/game_framework_ecy/game_framework_ecy/src/script/common/SoundManager.ts",
    "F:/gitpro/ecy_game_framework/game_framework_ecy/game_framework_ecy/src/script/minigame/MiniManeger.ts",
    "F:/gitpro/ecy_game_framework/game_framework_ecy/game_framework_ecy/src/script/games/ViewChangeManager.ts",
    "F:/gitpro/ecy_game_framework/game_framework_ecy/game_framework_ecy/src/script/common/GameData.ts",
    "F:/gitpro/ecy_game_framework/game_framework_ecy/game_framework_ecy/src/script/manager/AnimationManager.ts"
  ]
}
