{
  "code": "import * as tslib_1 from \"tslib\";\r\nimport GameLogicProcessingManager from \"../../games/GameLogicProcessingManager\";\r\nimport { PlayerDataManager } from \"../../common/GameDataManager\";\r\nimport ConfigManager from \"../../games/ConfigManager\";\r\nimport SoundManager from \"../../common/SoundManager\";\r\nimport { GoodsType } from \"../../games/CommonDefine\";\r\nimport { MiniManeger } from \"../../minigame/MiniManeger\";\r\nimport { GameData } from \"../../common/GameData\";\r\nvar SignView = (function (_super) {\r\n    tslib_1.__extends(SignView, _super);\r\n    function SignView() {\r\n        var _this = _super.call(this) || this;\r\n        _this.className_key = \"SignView\";\r\n        _this.showEnterType = BasePopAnimationEnterType.SCALE_MODE_BACK;\r\n        _this.bIsRunning = false;\r\n        _this.skin = \"game/uiView/SignView.json\";\r\n        return _this;\r\n    }\r\n    SignView.prototype.childrenCreated = function () {\r\n        _super.prototype.childrenCreated.call(this);\r\n        this.initView();\r\n    };\r\n    SignView.prototype.onAddStage = function () {\r\n        _super.prototype.onAddStage.call(this);\r\n        this.addEvent();\r\n        this.initView();\r\n        MiniManeger.instance.showBannerAd();\r\n    };\r\n    SignView.prototype.onRemoved = function () {\r\n        _super.prototype.onRemoved.call(this);\r\n        this.removeEvent();\r\n        this.bIsRunning = false;\r\n        Laya.Tween.clearAll(this.imageBtSign);\r\n        Laya.timer.clearAll(this);\r\n    };\r\n    SignView.prototype.initView = function () {\r\n        this.nCurTime = 0;\r\n        this.bDouble = false;\r\n        this.bIsRunning = true;\r\n        this.refreshSignData();\r\n        this.refreshSignView();\r\n        this.refreshSignRecvBt();\r\n        this.initDouble();\r\n        MiniManeger.instance.hideBlockAd();\r\n    };\r\n    SignView.prototype.addEvent = function () {\r\n        this.imageBtSign.on(Laya.Event.CLICK, this, this.onClick);\r\n        this.spBtClose.on(Laya.Event.CLICK, this, this.onClick);\r\n        this.boxDouble.on(Laya.Event.CLICK, this, this.onClick);\r\n    };\r\n    SignView.prototype.removeEvent = function () {\r\n        this.imageBtSign.off(Laya.Event.CLICK, this, this.onClick);\r\n        this.spBtClose.off(Laya.Event.CLICK, this, this.onClick);\r\n        this.boxDouble.off(Laya.Event.CLICK, this, this.onClick);\r\n    };\r\n    SignView.prototype.onClick = function (evt) {\r\n        var _this = this;\r\n        SoundManager.getInstance().playEffect(\"button\", 1);\r\n        switch (evt.currentTarget) {\r\n            case this.spBtClose:\r\n                if (DeviceUtil.isQQMiniGame() && GameData.getInstance().gameQQInfo.signCloseVideoOpen) {\r\n                    MiniManeger.instance.playViderAd({\r\n                        successFun: function () {\r\n                            _this.removeSelf();\r\n                        }\r\n                    });\r\n                }\r\n                else {\r\n                    this.removeSelf();\r\n                }\r\n                break;\r\n            case this.imageBtSign:\r\n                this.onSigned();\r\n                break;\r\n            case this.boxDouble:\r\n                this.onSignedDouble();\r\n                break;\r\n        }\r\n    };\r\n    SignView.prototype.removeSelf = function () {\r\n        MiniManeger.instance.showBlockAd();\r\n        return _super.prototype.removeSelf.call(this);\r\n    };\r\n    SignView.prototype.onSignedDouble = function () {\r\n        if (DeviceUtil.isQQMiniGame() && GameData.getInstance().gameQQInfo.signDoubleVideoOpen) {\r\n            MiniManeger.instance.playViderAd({});\r\n        }\r\n        this.spDouble.visible = !this.spDouble.visible;\r\n        this.bDouble = this.spDouble.visible;\r\n    };\r\n    SignView.prototype.refreshSignData = function () {\r\n        this.nCurTime = GameLogicProcessingManager.GetCurTime();\r\n        if (Utils.judgeIsOnTheSameDay(PlayerDataManager.getInstance().stPlayerDataBase.nSignTimeLast, this.nCurTime)) {\r\n            this.btDouble.visible = false;\r\n            return;\r\n        }\r\n        if (PlayerDataManager.getInstance().stPlayerDataBase.nSignIndex >= 7) {\r\n            PlayerDataManager.getInstance().stPlayerDataBase.nSignIndex = 0;\r\n        }\r\n    };\r\n    SignView.prototype.refreshSignView = function () {\r\n        var arySignData = ConfigManager.getInstance().getSignDataAll();\r\n        var nLen = arySignData.length;\r\n        var stImageTemp = null;\r\n        var stSpriteGoods = null;\r\n        for (var i = 0; i < nLen; ++i) {\r\n            stImageTemp = this.boxItem.getChildAt(i);\r\n            if (stImageTemp) {\r\n                if (i < 6) {\r\n                    stSpriteGoods = stImageTemp.getChildAt(2);\r\n                    if (stSpriteGoods) {\r\n                        if (arySignData[i].nType == 1) {\r\n                            stSpriteGoods.loadImage(\"resource/assets/img/common/maininterface_icon_7.png\");\r\n                        }\r\n                        else if (arySignData[i].nType == 2) {\r\n                            stSpriteGoods.loadImage(\"resource/assets/img/common/maininterface_icon_6.png\");\r\n                        }\r\n                    }\r\n                    var stBox = stImageTemp.getChildByName(\"boxWorld\");\r\n                    if (stBox) {\r\n                        var spNum = stBox.getChildByName(\"spWorld\");\r\n                        if (spNum) {\r\n                            BitmapLabelUtils.setLabel(spNum, arySignData[i].nCount.toString(), \"resource/assets/img/common/level_number1/level_number1_\", 0, \".png\", \"left\");\r\n                        }\r\n                    }\r\n                }\r\n                else {\r\n                    BitmapLabelUtils.setLabel(this.spWorldLeft, arySignData[i].nCount.toString(), \"resource/assets/img/common/level_number1/level_number1_\", 0, \".png\", \"left\");\r\n                    BitmapLabelUtils.setLabel(this.spWorldRight, arySignData[i].nCount7.toString(), \"resource/assets/img/common/level_number1/level_number1_\", 0, \".png\", \"left\");\r\n                }\r\n                var spSigned = stImageTemp.getChildByName(\"spSigned\");\r\n                if (spSigned) {\r\n                    if (i < PlayerDataManager.getInstance().stPlayerDataBase.nSignIndex) {\r\n                        spSigned.visible = true;\r\n                    }\r\n                    else {\r\n                        spSigned.visible = false;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n    SignView.prototype.initDouble = function () {\r\n        if (BaseConst.infos.gameInfo.double && BaseConst.infos.gameInfo.double == 1) {\r\n            this.spDouble.visible = true;\r\n        }\r\n        else {\r\n            this.spDouble.visible = false;\r\n        }\r\n        if (DeviceUtil.isQQMiniGame()) {\r\n            if (Math.random() < BaseConst.infos.gameInfo.siginC) {\r\n                this.spDouble.visible = true;\r\n            }\r\n            else {\r\n                this.spDouble.visible = false;\r\n            }\r\n        }\r\n        this.bDouble = this.spDouble.visible;\r\n    };\r\n    SignView.prototype.refreshSignRecvBt = function () {\r\n        this.nCurTime = GameLogicProcessingManager.GetCurTime();\r\n        ;\r\n        this.boxDouble.visible = true;\r\n        this.btDouble.visible = true;\r\n        this.spTomorrow.visible = true;\r\n        this.imageBtSign.visible = true;\r\n        if (Utils.judgeIsOnTheSameDay(PlayerDataManager.getInstance().stPlayerDataBase.nSignTimeLast, this.nCurTime)) {\r\n            this.boxDouble.visible = false;\r\n            this.btDouble.visible = false;\r\n            this.imageBtSign.visible = false;\r\n        }\r\n        else {\r\n            this.spTomorrow.visible = false;\r\n            this.startSignImageBtShareAni();\r\n        }\r\n    };\r\n    SignView.prototype.onSigned = function () {\r\n        if (this.bDouble) {\r\n            this.imageBtSign.off(Laya.Event.CLICK, this, this.onClick);\r\n            var self_1 = this;\r\n            MiniManeger.instance.playViderAd({\r\n                successFun: function () {\r\n                    self_1.procSignedData();\r\n                    self_1.imageBtSign.on(Laya.Event.CLICK, self_1, self_1.onClick);\r\n                },\r\n                failFun: function () {\r\n                    self_1.imageBtSign.on(Laya.Event.CLICK, self_1, self_1.onClick);\r\n                },\r\n                errorFun: function () {\r\n                    self_1.imageBtSign.on(Laya.Event.CLICK, self_1, self_1.onClick);\r\n                }\r\n            });\r\n        }\r\n        else {\r\n            this.procSignedData();\r\n        }\r\n    };\r\n    SignView.prototype.procSignedData = function () {\r\n        var stSignData = ConfigManager.getInstance().getSignDataBySignID(PlayerDataManager.getInstance().stPlayerDataBase.nSignIndex);\r\n        if (stSignData) {\r\n            var nValue = stSignData.nCount;\r\n            if (this.bDouble) {\r\n                nValue *= 2;\r\n            }\r\n            PlayerDataManager.getInstance().AddGoods(stSignData.nType, nValue);\r\n            if (stSignData.nType == GoodsType.enum_GoodsType_Sp) {\r\n                TipsManager.getInstance().showDefaultTips(\"体力+\" + nValue.toString());\r\n            }\r\n            if (PlayerDataManager.getInstance().stPlayerDataBase.nSignIndex == 6) {\r\n                var nValue_1 = stSignData.nCount7;\r\n                if (this.bDouble) {\r\n                    nValue_1 *= 2;\r\n                }\r\n                PlayerDataManager.getInstance().AddGoods(stSignData.nType7, nValue_1);\r\n            }\r\n        }\r\n        PlayerDataManager.getInstance().stPlayerDataBase.nSignIndex += 1;\r\n        PlayerDataManager.getInstance().stPlayerDataBase.nSignTimeLast = GameLogicProcessingManager.GetCurTime();\r\n        PlayerDataManager.getInstance().SaveData();\r\n        this.refreshSignView();\r\n        this.refreshSignRecvBt();\r\n    };\r\n    SignView.prototype.startSignImageBtShareAni = function () {\r\n        var _this = this;\r\n        if (!this.bIsRunning && this.imageBtSign.visible) {\r\n            return;\r\n        }\r\n        Laya.Tween.clearAll(this.imageBtSign);\r\n        Laya.Tween.to(this.imageBtSign, { scaleX: 1.1, scaleY: 1.1 }, 300, Laya.Ease.sineOut, Laya.Handler.create(this, function (args) {\r\n            Laya.Tween.to(_this.imageBtSign, { scaleX: 1, scaleY: 1 }, 300, Laya.Ease.sineOut, Laya.Handler.create(_this, function (args) {\r\n                Laya.timer.once(0, _this, _this.startSignImageBtShareAni);\r\n            }));\r\n        }));\r\n    };\r\n    return SignView;\r\n}(BaseSceneUISkinPopView));\r\nexport default SignView;\r\n",
  "references": [
    "F:/gitpro/ecy_game_framework/game_framework_ecy/game_framework_ecy/src/script/games/GameLogicProcessingManager.ts",
    "F:/gitpro/ecy_game_framework/game_framework_ecy/game_framework_ecy/src/script/common/GameDataManager.ts",
    "F:/gitpro/ecy_game_framework/game_framework_ecy/game_framework_ecy/src/script/games/ConfigManager.ts",
    "F:/gitpro/ecy_game_framework/game_framework_ecy/game_framework_ecy/src/script/common/SoundManager.ts",
    "F:/gitpro/ecy_game_framework/game_framework_ecy/game_framework_ecy/src/script/games/CommonDefine.ts",
    "F:/gitpro/ecy_game_framework/game_framework_ecy/game_framework_ecy/src/script/minigame/MiniManeger.ts",
    "F:/gitpro/ecy_game_framework/game_framework_ecy/game_framework_ecy/src/script/common/GameData.ts"
  ]
}
