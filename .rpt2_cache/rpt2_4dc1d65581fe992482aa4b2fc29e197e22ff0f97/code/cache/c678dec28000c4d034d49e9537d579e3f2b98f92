{
  "code": "import * as tslib_1 from \"tslib\";\r\nimport GameEvent from \"../../games/GameEvent\";\r\nimport { PlayerDataManager } from \"../../common/GameDataManager\";\r\nimport ConfigManager from \"../../games/ConfigManager\";\r\nimport AddPsView from \"./AddPsView\";\r\nimport SoundManager from \"../../common/SoundManager\";\r\nimport ViewChangeManager from \"../../games/ViewChangeManager\";\r\nimport { MiniManeger } from \"../../minigame/MiniManeger\";\r\nimport { GoodsType } from \"../../games/CommonDefine\";\r\nvar CommonView = (function (_super) {\r\n    tslib_1.__extends(CommonView, _super);\r\n    function CommonView() {\r\n        var _this = _super.call(this) || this;\r\n        _this.className_key = \"CommonView\";\r\n        _this.skin = \"game/uiView/CommonView.json\";\r\n        _this.width = 600;\r\n        _this.height = 200;\r\n        return _this;\r\n    }\r\n    CommonView.prototype.onAddStage = function () {\r\n        if (!this.isCreate) {\r\n            return;\r\n        }\r\n        this.addEventUpdateView();\r\n        this.refreshSPValue();\r\n        this.refreshGoldValue();\r\n        this.refreshTimeView();\r\n        this.refreshPsLimitLess();\r\n        if (BaseConst.infos.gameInfo.openPsAward == 1 && DeviceUtil.isQQMiniGame() || DeviceUtil.isTTMiniGame()) {\r\n            this.imageBtGoldAdd.visible = true;\r\n        }\r\n    };\r\n    CommonView.prototype.childrenCreated = function () {\r\n        this.refreshSPValue();\r\n        this.refreshGoldValue();\r\n        this.refreshTimeView();\r\n    };\r\n    CommonView.prototype.onRemoved = function () {\r\n        this.removeEnentUpdateView();\r\n    };\r\n    CommonView.prototype.addEventUpdateView = function () {\r\n        this.sp.on(Laya.Event.CLICK, this, this.openAddSp);\r\n        if (!DeviceUtil.isWXMiniGame()) {\r\n            this.glod.on(Laya.Event.CLICK, this, this.onAddGold);\r\n        }\r\n        EventMgr.getInstance().addEvent(GameEvent.ON_PS_CHANGE, this, this.refreshSPValue);\r\n        EventMgr.getInstance().addEvent(GameEvent.ON_GLOD_CHANGE, this, this.refreshGoldValue);\r\n        EventMgr.getInstance().addEvent(GameEvent.ON_SP_UPDOWN_TIME, this, this.refreshTimeLableInfo);\r\n        EventMgr.getInstance().addEvent(GameEvent.PS_LIMITLESS, this, this.refreshPsLimitLess);\r\n    };\r\n    CommonView.prototype.addBtEvent = function () {\r\n        this.imageBtAttSp.visible = true;\r\n        this.sp && this.sp.on(Laya.Event.CLICK, this, this.openAddSp);\r\n        if (BaseConst.infos.gameInfo.openPsAward == 1 && DeviceUtil.isQQMiniGame() || DeviceUtil.isTTMiniGame()) {\r\n            this.imageBtGoldAdd.visible = true;\r\n            this.glod && this.glod.on(Laya.Event.CLICK, this, this.onAddGold);\r\n        }\r\n    };\r\n    CommonView.prototype.removeBtEvent = function () {\r\n        this.imageBtAttSp.visible = false;\r\n        this.imageBtGoldAdd.visible = false;\r\n        this.sp && this.sp.off(Laya.Event.CLICK, this, this.openAddSp);\r\n        if (DeviceUtil.isQQMiniGame() || DeviceUtil.isTTMiniGame()) {\r\n            this.glod && this.glod.off(Laya.Event.CLICK, this, this.onAddGold);\r\n        }\r\n    };\r\n    CommonView.prototype.onAddGold = function () {\r\n        if (BaseConst.infos.gameInfo.openPsAward == 1 && DeviceUtil.isQQMiniGame() || DeviceUtil.isTTMiniGame()) {\r\n            MiniManeger.instance.playViderAd({\r\n                successFun: function () {\r\n                    TipsManager.getInstance().showDefaultTips(\"金币+\" + 100);\r\n                    PlayerDataManager.getInstance().AddGoods(GoodsType.enum_GoodsType_Glod, 100);\r\n                }\r\n            });\r\n        }\r\n    };\r\n    CommonView.prototype.removeEnentUpdateView = function () {\r\n        this.sp.off(Laya.Event.CLICK, this, this.openAddSp);\r\n        this.glod.off(Laya.Event.CLICK, this, this.onAddGold);\r\n        EventMgr.getInstance().removeEvent(GameEvent.ON_PS_CHANGE, this, this.refreshSPValue);\r\n        EventMgr.getInstance().removeEvent(GameEvent.ON_GLOD_CHANGE, this, this.refreshGoldValue);\r\n        EventMgr.getInstance().removeEvent(GameEvent.ON_SP_UPDOWN_TIME, this, this.refreshTimeLableInfo);\r\n        EventMgr.getInstance().removeEvent(GameEvent.PS_LIMITLESS, this, this.refreshPsLimitLess);\r\n    };\r\n    CommonView.prototype.openAddSp = function () {\r\n        SoundManager.getInstance().playEffect(\"button\", 1);\r\n        ViewChangeManager.getInstance().showBufferLoadingView();\r\n        ResUtil.getIntance().loadGroups([\"adsp\"], function () {\r\n            ViewManager.getInstance().showView(AddPsView);\r\n            ViewChangeManager.getInstance().hideBufferLoadingView();\r\n        });\r\n    };\r\n    CommonView.prototype.refreshSPValue = function () {\r\n        if (!this.isCreate) {\r\n            return;\r\n        }\r\n        if (PlayerDataManager.getInstance().isPsLimitlessState()) {\r\n            return;\r\n        }\r\n        BitmapLabelUtils.setLabel(this.spNum, PlayerDataManager.getInstance().stPlayerDataBase.nPS.toString(), \"resource/assets/img/ui/gamehome/maininterface_number1/maininterface_number1_\", 0, \".png\", \"center\");\r\n        this.refreshTimeView();\r\n    };\r\n    CommonView.prototype.refreshGoldValue = function () {\r\n        if (!this.isCreate) {\r\n            return;\r\n        }\r\n        BitmapLabelUtils.setLabel(this.glodNum, PlayerDataManager.getInstance().stPlayerDataBase.nGlodCount.toString(), \"resource/assets/img/common/level_number12/level_number1_\", 0, \".png\", \"left\");\r\n    };\r\n    CommonView.prototype.refreshTimeView = function () {\r\n        if (PlayerDataManager.getInstance().isPsLimitlessState()) {\r\n            return;\r\n        }\r\n        var nSpTimeMax = 5;\r\n        var stGameData = ConfigManager.getInstance().getGameConfigDataByID(1);\r\n        if (stGameData) {\r\n            nSpTimeMax = parseInt(stGameData.strValue);\r\n        }\r\n        if (nSpTimeMax <= PlayerDataManager.getInstance().stPlayerDataBase.nPS) {\r\n            this.imageSpFull.visible = true;\r\n            this.stLableTime.visible = false;\r\n            this.stLableTime.text = \"\";\r\n        }\r\n        else {\r\n            this.imageSpFull.visible = false;\r\n            this.stLableTime.visible = true;\r\n        }\r\n    };\r\n    CommonView.prototype.refreshTimeLableInfo = function () {\r\n        if (PlayerDataManager.getInstance().isPsLimitlessState()) {\r\n            return;\r\n        }\r\n        this.imageSpFull.visible = false;\r\n        this.stLableTime.visible = true;\r\n        this.stLableTime.text = PlayerDataManager.getInstance().getSpLastTime();\r\n    };\r\n    CommonView.prototype.refreshPsLimitLess = function () {\r\n        if (!PlayerDataManager.getInstance().isPsLimitlessState()) {\r\n            return;\r\n        }\r\n        this.stLableTime.visible = false;\r\n        this.spNum.visible = false;\r\n        this.imageSpFull.visible = true;\r\n        this.imageSpFull.skin = \"resource/assets/img/ui/gamehome/maininterface_word_3.png\";\r\n        this.sp.skin = \"resource/assets/img/ui/gamehome/maininterface_baseboard_1_2.png\";\r\n    };\r\n    return CommonView;\r\n}(BaseSceneUISkin));\r\nexport default CommonView;\r\n",
  "references": [
    "F:/gitpro/ecy_game_framework/game_framework_ecy/game_framework_ecy/src/script/games/GameEvent.ts",
    "F:/gitpro/ecy_game_framework/game_framework_ecy/game_framework_ecy/src/script/common/GameDataManager.ts",
    "F:/gitpro/ecy_game_framework/game_framework_ecy/game_framework_ecy/src/script/games/ConfigManager.ts",
    "F:/gitpro/ecy_game_framework/game_framework_ecy/game_framework_ecy/src/script/views/game/AddPsView.ts",
    "F:/gitpro/ecy_game_framework/game_framework_ecy/game_framework_ecy/src/script/common/SoundManager.ts",
    "F:/gitpro/ecy_game_framework/game_framework_ecy/game_framework_ecy/src/script/games/ViewChangeManager.ts",
    "F:/gitpro/ecy_game_framework/game_framework_ecy/game_framework_ecy/src/script/minigame/MiniManeger.ts",
    "F:/gitpro/ecy_game_framework/game_framework_ecy/game_framework_ecy/src/script/games/CommonDefine.ts"
  ]
}
